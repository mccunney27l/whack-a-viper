<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-A-Viper</title>
    <!-- Load Tailwind CSS for utilities and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap');
        :root {
            --dirt-brown: #8B4513;
            --grass-green: #7CFC00;
            --hole-dark: #3a1f0a;
            --snake-green: #cc72c3;
            --snake-dark: #8a3882;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fadb84; /* Light sand color */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .game-title {
            font-family: 'Luckiest Guy', cursive;
            color: var(--dirt-brown);
            text-shadow: 3px 3px 0 #fff, 6px 6px 0 var(--grass-green);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            background-color: var(--dirt-brown);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            max-width: 600px;
            width: 100%;
        }

        .hole {
            background-color: var(--hole-dark);
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="%23000" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14h-2v-2h2v2zm0-4h-2V7h2v5z"/></svg>') 15 15, pointer;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
        }

        .snake {
            background-color: var(--snake-green);
            background-image: linear-gradient(135deg, var(--snake-green) 0%, var(--snake-dark) 100%);
            width: 80%;
            height: 100%;
            margin: 0 10%;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            position: absolute;
            bottom: -100px; /* Initially hidden below the hole */
            transition: all 0.2s ease-out;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            font-size: 2rem;
            padding-bottom: 5px;
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.3);
        }

        .snake.up {
            bottom: 0; /* Pop up */
            pointer-events: auto; /* Allow clicking when up */
        }

        .hit {
            background-color: var(--grass-green) !important;
            transition: background-color 0s;
        }

        .game-button {
            transition: all 0.1s ease-in-out;
            box-shadow: 0 4px 0 var(--dirt-brown);
        }

        .game-button:active {
            box-shadow: 0 1px 0 var(--dirt-brown);
            transform: translateY(3px);
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div id="app" class="flex flex-col items-center p-4 bg-white rounded-xl shadow-2xl w-full max-w-lg">
        <h1 class="game-title text-5xl mb-4 sm:text-6xl">Whack-A-Viper</h1>
        <div class="flex justify-between items-center w-full mb-6 text-xl sm:text-2xl font-bold text-gray-800">
            <span>Score: <span id="score">0</span></span>
            <span>Time: <span id="time">30</span>s</span>
        </div>

        <!-- Game Board (Holes Grid) -->
        <div class="board" id="game-board">
            <div class="hole" data-hole="0"><div class="snake" data-snake="0">üêç</div></div>
            <div class="hole" data-hole="1"><div class="snake" data-snake="1">üêç</div></div>
            <div class="hole" data-hole="2"><div class="snake" data-snake="2">üêç</div></div>
            <div class="hole" data-hole="3"><div class="snake" data-snake="3">üêç</div></div>
            <div class="hole" data-hole="4"><div class="snake" data-snake="4">üêç</div></div>
            <div class="hole" data-hole="5"><div class="snake" data-snake="5">üêç</div></div>
            <div class="hole" data-hole="6"><div class="snake" data-snake="6">üêç</div></div>
            <div class="hole" data-hole="7"><div class="snake" data-snake="7">üêç</div></div>
            <div class="hole" data-hole="8"><div class="snake" data-snake="8">üêç</div></div>
        </div>

        <!-- Controls and Status -->
        <button id="start-button" class="game-button mt-8 w-48 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl text-xl">
            Start Game
        </button>

        <div id="message-box" class="mt-4 p-3 text-center bg-yellow-100 border border-yellow-400 text-yellow-800 rounded-lg hidden w-full">
            Ready to play! Hit the snake to score points!
        </div>
    </div>

    <script>
        // --- Game Setup ---
        const holes = document.querySelectorAll('.hole');
        const snakes = document.querySelectorAll('.snake');
        const scoreDisplay = document.getElementById('score');
        const timeDisplay = document.getElementById('time');
        const startButton = document.getElementById('start-button');
        const messageBox = document.getElementById('message-box');
        
        let score = 0;
        let lastHole = null;
        let timeLimit = 30;
        let timeRemaining = timeLimit;
        let gameTimer = null;
        let peepTimer = null;
        let isGameOver = true;

        // --- Utility Functions ---

        // Gets a random amount of time for the snake to stay up (between 500ms and 1500ms)
        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        // Selects a random hole that is NOT the last hole
        function randomHole(holes) {
            const index = Math.floor(Math.random() * holes.length);
            const hole = holes[index];
            if (hole === lastHole) {
                return randomHole(holes); // Recursively try again if it's the same hole
            }
            lastHole = hole;
            return hole;
        }

        // Shows the message box with a custom message and background color
        function showMessage(text, bgColor = 'bg-yellow-100', borderColor = 'border-yellow-400', textColor = 'text-yellow-800') {
            messageBox.textContent = text;
            messageBox.className = `mt-4 p-3 text-center ${bgColor} ${borderColor} ${textColor} rounded-lg w-full`;
            messageBox.classList.remove('hidden');
        }

        // --- Game Logic ---

        // Makes a snake pop up and hides it after a random time
        function peep() {
            const hole = randomHole(holes);
            const snake = hole.querySelector('.snake');
            const time = randomTime(500, 1500); // Time snake stays up

            // Show the snake (add 'up' class)
            snake.classList.add('up');
            
            setTimeout(() => {
                // Hide the snake (remove 'up' class)
                snake.classList.remove('up');
                
                // Continue peeping if the game is still active
                if (!isGameOver) {
                    peepTimer = setTimeout(peep, randomTime(800, 1800)); // Time until next snake appears
                }
            }, time);
        }

        // Handles a hit on the snake
        function bonk(event) {
            // Check if the snake is currently up and clickable
            if (!event.isTrusted || !this.classList.contains('up') || isGameOver) return; 

            score++;
            scoreDisplay.textContent = score;

            // Flash the snake green and immediately hide it
            this.classList.add('hit');
            this.classList.remove('up');

            // Remove the flash class after a very short time
            setTimeout(() => {
                this.classList.remove('hit');
            }, 100);
            
            // Clear the existing peep timeout and call peep again immediately for a fresh start
            clearTimeout(peepTimer);
            peepTimer = setTimeout(peep, 100); 
        }

        // Handles the countdown timer
        function countdown() {
            timeRemaining--;
            timeDisplay.textContent = timeRemaining;

            if (timeRemaining <= 0) {
                clearInterval(gameTimer);
                isGameOver = true;
                clearTimeout(peepTimer);
                endGame();
            }
        }

        // Starts the main game loop
        function startGame() {
            if (!isGameOver) return; // Prevent double starting
            
            isGameOver = false;
            score = 0;
            timeRemaining = timeLimit;
            scoreDisplay.textContent = score;
            timeDisplay.textContent = timeRemaining;
            startButton.disabled = true;
            startButton.textContent = 'Playing...';
            showMessage("WHACK! Don't let the vipers get away!", 'bg-blue-100', 'border-blue-400', 'text-blue-800');

            // Clear any existing timers
            if (gameTimer) clearInterval(gameTimer);
            if (peepTimer) clearTimeout(peepTimer);

            // Start the countdown
            gameTimer = setInterval(countdown, 1000);

            // Start the snake peeping
            peep();
        }

        // Ends the game
        function endGame() {
            isGameOver = true;
            startButton.disabled = false;
            startButton.textContent = 'Play Again';
            
            // Ensure all snakes are hidden
            snakes.forEach(snake => snake.classList.remove('up'));

            showMessage(`Game Over! Your final score is ${score}!`, 'bg-red-100', 'border-red-400', 'text-red-800');
        }

        // --- Event Listeners and Initialization ---

        // Attach event listener to each snake element
        snakes.forEach(snake => snake.addEventListener('click', bonk));
        
        // Attach event listener to the start button
        startButton.addEventListener('click', startGame);

        // Initial message
        window.onload = () => {
             showMessage("Click 'Start Game' to begin Whack-A-Viper!", 'bg-yellow-100', 'border-yellow-400', 'text-yellow-800');
        }

    </script>
</body>
</html>
